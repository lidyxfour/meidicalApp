<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
	    <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
	    <meta name="apple-mobile-web-app-capable" content="yes">
	    <meta name="apple-mobile-web-app-status-bar-style" content="#000000">
	    <title>outbreak_display</title>
	    <script src="js/mui.min.js"></script>
	    <script src="libs/echarts-all.js"></script>
	    <script src="js/app.js"></script>
	    <link href="css/mui.min.css" rel="stylesheet"/>
	     <link href="app.css" rel="stylesheet"/>
	    <link href="css/style.css" rel="stylesheet"/>
	    <style type="text/css">
	    body{
	    	font-family: "微软雅黑";
	    }
	    .outbreak{
	    	font-family: "微软雅黑";
			margin: 10px 10px;
			width: auto;
			height: 140px;
			border: solid #56ABE4;
	    }
	    .upper-bar{
	    	color: #F3F3F3;
	    	background-color: #56ABE4;
	    	font-weight: bold;	
	    }
	    .lower-bar{
	    padding: 5px;
	    float: left;
	    }
	    .out_break_item{
	    	font-size: 12px;
	    }
	    .pic_display{
	    	margin-top: 15px;
	    	margin-left: 10px;
	    	height: 80px;
	    	width: 80px;
	    }
	    
	    </style>
	</head>
	<body>
		<header class="mui-bar mui-bar-nav">
			<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></a>
			<h1 class="mui-title">我的发病记录</h1>
			<div id="main-jump" class="main-jump-btn" style="float: right;">
			<a id="main-jump-btn"><span class="mui-icon mui-icon-home"></span></a>
			<!--<button id="main-jump-btn" class="mui-btn"><span class="mui-icon mui-icon-home"></span></button>-->
		</header>
		
		<div class="mui-content">
			<div class="outbreak">
				<div class="upper-bar">
				2016-05-07
				</div>
				<div class="lower-bar">
					<div class="out_break_item">
					天气 ：<span id="outbreak_weather">小雨 18°</span>
					</div>
					<div class="out_break_item">
					缓解时间：<span id="outbreak_medicine">20</span> min
					</div>
					<div class="out_break_item">
					用药 ：<span id="outbreak_medicine">丙酸氟替卡松气雾剂</span>
					</div>
					<div class="out_break_item">
					是否就医：<span id="outbreak_medicine">已就医</span>
					</div>
					<div class="out_break_item">
					详细记录：<span id="outbreak_medicine">医生开药缓解</span>
					</div>
				</div>
				<img class="pic_display" src="images/prescription.jpg"/>
			</div>
			<div class="outbreak">
				<div class="upper-bar">
				2016-05-06
				</div>
				<div class="lower-bar">
					<div class="out_break_item">
					天气 ：<span id="outbreak_weather">阴 20°</span>
					</div>
					<div class="out_break_item">
					缓解时间：<span id="outbreak_medicine">45</span> min
					</div>
					<div class="out_break_item">
					用药 ：<span id="outbreak_medicine">布地奈德气雾剂</span>
					</div>
					<div class="out_break_item">
					是否就医：<span id="outbreak_medicine">未就医</span>
					</div>
				</div>
			</div>
			<div class="outbreak">
				<div class="upper-bar">
				2016-05-04
				</div>
				<div class="lower-bar">
					<div class="out_break_item">
					天气 ：<span id="outbreak_weather">晴 24°</span>
					</div>
					<div class="out_break_item">
					缓解时间：<span id="outbreak_medicine">60</span> min
					</div>
					<div class="out_break_item">
					用药 ：<span id="outbreak_medicine">曲尼斯特</span>
					</div>
					<div class="out_break_item">
					是否就医：<span id="outbreak_medicine">已就医</span>
					</div>
					<div class="out_break_item">
					详细记录：<span id="outbreak_medicine">伴有皮肤过敏症状</span>
					</div>
				</div>
				<img class="pic_display" src="images/allergic_pic.jpg"/>
			</div>
			<div class="outbreak">
				<div class="upper-bar">
				2016-05-03
				</div>
				<div class="lower-bar">
					<div class="out_break_item">
					天气 ：<span id="outbreak_weather">晴 23°</span>
					</div>
					<div class="out_break_item">
					缓解时间：<span id="outbreak_medicine">15</span> min
					</div>
					<div class="out_break_item">
					用药 ：<span id="outbreak_medicine">布地奈德气雾剂</span>
					</div>
					<div class="out_break_item">
					是否就医：<span id="outbreak_medicine">未就医</span>
					</div>
					<div class="out_break_item">
					详细记录：<span id="outbreak_medicine">吸入后效果显著</span>
					</div>
				</div>
			</div>
			
		</div>
		
		
	</body>
	<script type="text/javascript">
		(function($, doc) {
				$.init();
				$.plusReady(function() {
					//获取数据
					//getOutbreakRecord();
					
					//回到首页
					var mainPage = $.preload({
						"id":'main',
						"url":'main.html'
					});
					
				    var mainJumpButton = doc.getElementById('main-jump-btn');
				    
				    mainJumpButton.addEventListener('tap',function(event){
				    	$.openWindow({
				    		id:'main',
				    		show: {
								aniShow: 'pop-in'
							},
				    		styles:{
				    			popGesture:'hide'
				    		},
				    		waiting:{
				    			autoShow: false
				    		}
				    	});
				    });
				});
				function getOutbreakRecord(){
				    	var jsonData;
				    	var username = 'test4';
				    	var index = 1;
				    	var getORXhr = new plus.net.XMLHttpRequest();
						getORXhr.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=utf-8;");
						getORXhr.open("GET","http://139.129.18.57/get_outbreak_record.php?username="+username);
						getORXhr.send();

						getORXhr.onreadystatechange = function () {
					        switch ( getORXhr.readyState ) {
					            case 0:
					            	console.log( "getORXhr请求已初始化" );
					            break;
					            case 1:
					            	console.log( "getORXhr请求已打开" );
					            break;
					            case 2:
					            	console.log( "getORXhr请求已发送" );
					            break;
					            case 3:
					                console.log( "getORXhr请求已响应");
					            break;
					            case 4:
					                console.log( "getORXhr请求已完成");
					                if ( getORXhr.status == 200 ) {
					                	alert( "getORXhr请求成功："+getORXhr.responseText );
					                	jsonData = getORXhr.responseText;
					                	console.log(jsonData);
					                	var dataObj = eval(jsonData);
					                	console.log(dataObj[0].datetime);
					                }else{
					                	alert( "getORXhr请求失败："+getORXhr.status );
					                }
					            break;
					            default :
					                break;
						        }
							};
			        
				   function updateData(){
				   		
					    var dataObj = eval(jsonData);
					    var count = dataObj.length;
					    console.log("执行测试");
					    
					    var r_date = dataObj[0].datetime;
					    var r_weather = dataObj[0].weather;
					    var r_release = dataObj[0].recovertime;
					    var r_medi = dataObj[0].medicine;
					    var r_treat = dataObj[0].treatment;
					    var r_detail = dataObj[0].description;
					    var r_img = dataObj[0].img;
					    
					    appendRecord(r_date,r_weather,r_release,r_medi,r_treat,r_detail,r_img);
					    
					    function appendRecord(t_date,t_weather,t_release,t_medi,t_treat,t_detail,t_img){
					    	var recordList = document.getElementById("recordlist");
					    	var newRecord = document.createElement("div");
					    	newRecord.id = "record"+index;
					    	newRecord.className = "outbreak";
					    	newRecord.innerHTML = '<div class="upper-bar"></div><div class="lower-bar"><div class="out_break_item">天气 ：<span id="outbreak_weather"></span></div><div class="out_break_item">缓解时间：<span id="outbreak_release"></span> min</div><div class="out_break_item">用药 ：<span id="outbreak_medicine"></span></div><div class="out_break_item">是否就医：<span id="outbreak_treatment"></span></div><div class="out_break_item">详细记录：<span id="outbreak_detail"></span></div></div><img id="outbreak_img" class="pic_display" src=""/>';
					    	recordList.appendChild(newRecord);
						}  
				   }
				}
			}(mui, document));
	</script>
</html>
